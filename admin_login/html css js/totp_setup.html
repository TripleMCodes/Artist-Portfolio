<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Set Up Two-Factor Authentication</title>
    <link rel="stylesheet" href="{{ url_for('home.static', filename='styles.css') }}">
</head>

<body>

    <!-- Background Particles -->
    <!-- <div class="particles">
        {% for i in range(35) %}
            <div class="particle" style="
                width: {{ 5 + loop.index }}px;
                height: {{ 5 + loop.index }}px;
                top: {{ (loop.index * 30) % 500 }}px;
                left: {{ (loop.index * 57) % 1200 }}px;
                animation-duration: {{ 10 + (loop.index % 10) }}s;">
            </div>
        {% endfor %}
    </div> -->

    <div class="particles" id="particles"></div>

    <!-- Main Container -->
    <main style="max-width: 650px; margin: 6rem auto;">

        <div class="about-section" style="text-align: center; padding: 3rem;">

            <h2 style="margin-bottom: 1.5rem;">Enable Two-Factor Authentication</h2>

            <p style="color: #c4b5fd; margin-bottom: 2rem;">
                Scan the QR code below with your authenticator app (Google Authenticator, Authy, FreeOTP).
            </p>

            <!-- QR CODE -->
            <div style="margin-bottom: 2rem;">
                <img src="data:image/png;base64,{{ qr }}" 
                     alt="QR Code"
                     style="width: 220px; height: 220px; border-radius: 12px; border: 3px solid rgba(168, 85, 247, 0.4);">
            </div>

            <!-- Secret Key Fallback -->
            <p style="color: #9ca3af; margin-bottom: 0.5rem;">Or enter this key manually:</p>

            <div style="
                background: rgba(30,41,59,0.6);
                border: 1px solid rgba(168,85,247,0.3);
                padding: 0.8rem 1.2rem;
                border-radius: 10px;
                font-size: 1.1rem;
                color: #e0e0e0;
                letter-spacing: 2px;
                margin-bottom: 2rem;">
                {{ secret }}
            </div>

            <p style="color: #c4b5fd; margin-bottom: 2rem;">
                After scanning, enter the first 6-digit code generated by your app to complete setup.
            </p>

            <!-- Flash Messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div style="margin-bottom: 1.5rem;">
                        {% for category, message in messages %}
                            <div style="
                                background: rgba(168, 85, 247, 0.15);
                                padding: 0.75rem 1rem;
                                border-radius: 8px;
                                border: 1px solid rgba(168, 85, 247, 0.4);
                                color: #e0e0e0;
                                margin-bottom: 0.5rem;">
                                {{ message }}
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}

            <!-- CONFIRM FORM -->
            <form action="{{ url_for('admin.totp_confirm') }}" method="POST"
                  style="display: flex; flex-direction: column; gap: 1.5rem;">

                <input 
                    type="text"
                    name="code"
                    placeholder="6-digit verification code"
                    maxlength="6"
                    required
                    style="
                        padding: 1rem;
                        border-radius: 10px;
                        border: 2px solid rgba(168, 85, 247, 0.4);
                        background: rgba(30, 41, 59, 0.5);
                        color: #e0e0e0;
                        font-size: 1.2rem;
                        text-align: center;
                        letter-spacing: 5px;
                        outline: none;
                        transition: 0.3s;
                    "
                    onfocus="this.style.borderColor='#a855f7';"
                    onblur="this.style.borderColor='rgba(168, 85, 247, 0.4)';"
                >

                <button 
                    type="submit"
                    class="cta-button"
                    style="width: 100%; border-radius: 12px;">
                    Confirm Setup
                </button>
            </form>

        </div>
    </main>

</body>
</html>
